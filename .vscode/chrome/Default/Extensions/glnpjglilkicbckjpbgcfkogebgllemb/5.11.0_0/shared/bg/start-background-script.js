Okta.startBackgroundScript=function(e,t,r,n){var a="CONTENT_SCRIPT",s="LAST_CHECK",o="INJECTION_COUNT",u="DBG_PLUGIN_SETTINGS",i=5,c=1e3,l=Okta.Q.when,k=Okta.fn.storage.unwrapVal,g=Okta.fn.storage.wrapVal,f=Okta.fn.base.timestamp,p=_okta.isNull,d=_okta.compose,T=_okta.isUndefined,y=Okta.Q,S=_okta.partial,C=Okta.fn.base.orDefault;function b(e){return"_lock_"+e}function m(e){t.set(b(e),null);return true}function v(e){var r=f(),n=b(e),a=t.get(n);if(!a||r>a.lockTime+c){t.set(n,{lockTime:r});return true}else{return false}}function I(a,s,o){switch(a){case"getSessionState":return t.get(o.key);case"setSessionState":return t.set(o.key,o.val);case"getPersistentState":return r.get(o.key);case"setPersistentState":return r.set(o.key,o.val);case"getTabId":return s;case"getBrowserType":return e.getType();case"getBackgroundVersion":return e.getBackgroundVersion();case"unlockSessionKey":return m(o.key);case"lockSessionKey":return v(o.key);case"request":return n.ajax(o);case"openTab":return e.openTab(o.url);case"closeTab":return e.closeTab(s);case"getCookies":if(T(e.getCookies)){return y({errorCode:"not supported by this version of plugin"})}return e.getCookies(o.key.hostUrl,o.key.cookieNames);default:return y({errorCode:"Unknown msg type: "+a})}}var _=d(C(0),k,S(r.get,o));var O=d(S(r.set,o),g);var N=d(C(0),k,S(r.get,u));function w(){var e=N();return e&&e.useLocalJS}e.on("injectReady",function(t){var n=k(r.get(a)),o=_();if(w()){e.injectScript(t,null);return}if(p(n)){O(0)}else if(o<i){O(o+1)}else{O(0);r.set(a,g(null));r.set(s,g(null));n=null}e.injectScript(t,n)});e.on("messageFromContent",function(t){var r=t.msg,n=I(r.type,t.tabId,r.data);l(n,function(n){e.post({msg:{id:r.id,data:n},tabId:t.tabId,portInfo:t.portInfo})}).done()})};