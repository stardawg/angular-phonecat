Okta.ChromeBrowser=function(e,t,n){var r=PLUGIN_VERSIONS.currentVersion;var a=_okta.extend,o=_okta.find,i=_okta.where,u=Okta.Q.defer,s=Okta.Q,c=Okta.Events,f=Okta.fn.base.curry2,d=Okta.fn.base.always,m=Okta.fn.base.delay,l=Okta.fn.base.invoke,h=Okta.fn.url.isOktaHref,b=Okta.fn.bg.findAuthSite,g=Okta.fn.bg.getLastAuthTimestamp,p=Okta.fn.bg.setLastAuthTimestamp,k=Okta.fn.bg.getBasicAuthCreds,v=Okta.Url,I=_okta.filter,O=a({},c);var L=2*1e3,A="chrome";function w(e){var t=u();chrome.tabs.query({},function n(r){var a=i(r,{id:e}).length>0;if(a){chrome.tabs.get(e,function o(e){t.resolve(e)})}else{t.resolve(null)}});return t.promise}function y(e){return e}function R(e){return!e||!/^http/.test(e.url)}function S(e){var t=u();chrome.webNavigation.getAllFrames({tabId:e},function(e){t.resolve(e)});return t.promise}function _(e){w(e.tabId).then(function t(n){if(R(n)){return}O.trigger("injectReady",{tabId:n.id,frameId:e.frameId,url:e.url})})}function C(e,t){O.trigger("messageFromContent",{msg:t,tabId:e.sender.tab?e.sender.tab.id:-1,portInfo:{port:e}})}function B(r,a){var o,i;o=b(t,new v(r.url));if(!o||!o.credURI){return a()}i=g(e,o.authURL);if(r.timeStamp-i<L){return a()}p(e,o.authURL,r.timeStamp);k(n,t,o.credURI).then(function(e){if(e&&e.u&&e.p){a({authCredentials:{username:e.u,password:e.p}})}else{return a()}})}O.getType=d(A);O.getBackgroundVersion=d(r);O.post=function U(e){e.portInfo.port.postMessage(e.msg)};O.injectScript=function j(e,t){var n={frameId:e.frameId,runAt:"document_idle",matchAboutBlank:false};if(t){n.code=t;Log.info("Injecting content script from persistent")}else{n.file="shared/shared.js";Log.info("Injecting content script from file")}var r="(function () {      return (typeof Okta === 'undefined');    })();";var a={frameId:e.frameId,runAt:"document_idle",matchAboutBlank:false};a.code=r;chrome.tabs.executeScript(e.tabId,a,function(t){if(chrome.runtime.lastError){return}var r=typeof t==="undefined"?false:t[0];if(r){chrome.tabs.executeScript(e.tabId,n,function(e){if(chrome.runtime.lastError){return}})}})};O.openTab=function(e){if(e){chrome.tabs.create({url:e})}};O.closeTab=function(e){if(e){chrome.tabs.remove(e)}};O.getCookies=function(e,t){var n=u();chrome.cookies.getAll({url:e},function(e){var r=I(e,function(e){return t.indexOf(e.name)>-1});n.resolve(r)});return n.promise};var T=f(C);chrome.webNavigation.onDOMContentLoaded.addListener(_);chrome.webNavigation.onTabReplaced.addListener(_);chrome.extension.onConnect.addListener(function x(e){e.onMessage.addListener(T(e))});chrome.webRequest.onAuthRequired.addListener(B,{urls:["<all_urls>"]},["asyncBlocking"]);return O};